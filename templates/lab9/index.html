{% extends "base.html" %}

{% block lab %}–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 9{% endblock %}

{% block script %}
<script src="{{ url_for('static', filename='lab9/lab9.js') }}"></script>
{% endblock %}

{% block main %}
<div class="container">
    <!-- –°–∫—Ä—ã—Ç—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="auth-status" data-authenticated="{{ 'true' if is_auth else 'false' }}" style="display: none;"></div>
    
    <h1>üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –ü–æ–¥–∞—Ä–∫–∏ üéÑ</h1>
    
    <div class="auth-controls">
        {% if is_auth %}
        <div class="user-info">
            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ login }}!
            <a href="{{ url_for('lab9.logout') }}" class="btn btn-logout">–í—ã–π—Ç–∏</a>
        </div>
        {% else %}
        <div class="auth-links">
            <a href="{{ url_for('lab9.login') }}" class="btn btn-login">–í–æ–π—Ç–∏</a>
            <a href="{{ url_for('lab9.register') }}" class="btn btn-register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        </div>
        {% endif %}
    </div>
    
    <div class="stats">
        <div class="stat-item">
            <div class="stat-label">–û—Ç–∫—Ä—ã—Ç–æ –∫–æ—Ä–æ–±–æ–∫:</div>
            <div class="stat-value" id="opened-count">{{ opened_count }}</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">–û—Å—Ç–∞–≤—à–∏—Ö—Å—è –ø–æ–¥–∞—Ä–∫–æ–≤:</div>
            <div class="stat-value" id="remaining-count">{{ remaining }}</div>
        </div>
    </div>
    
    <div class="controls">
        {% if is_auth %}
        <button id="santa-btn" class="btn">üéÖ –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞ –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏!</button>
        {% endif %}
    </div>
    
    <div id="gifts-container">
        {% for gift in gifts %}
        <div class="gift-box {% if gift.opened %}opened{% endif %}" 
             data-id="{{ gift.position_id }}"
             data-require-auth="{{ gift.require_auth }}"
             style="top: {{ gift.top_position }}%; left: {{ gift.left_position }}%;">
            {% if gift.opened %}
            <div class="opened-gift">
                <div class="congratulation">
                    <p>{{ gift.message }}</p>
                </div>
                <img src="{{ gift.image }}" alt="–ü–æ–¥–∞—Ä–æ–∫" class="gift-inside">
            </div>
            {% else %}
            <img src="{{ gift.box_image }}" 
                 alt="–ü–æ–¥–∞—Ä–æ–∫ {{ gift.position_id + 1 }}"
                 title="{% if gift.require_auth and not is_auth %}–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è{% else %}–û—Ç–∫—Ä—ã—Ç—å –ø–æ–¥–∞—Ä–æ–∫{% endif %}"
                 class="gift-box-image">
            {% if gift.require_auth and not is_auth %}
            <div class="lock-icon">üîí</div>
            {% endif %}
            {% endif %}
        </div>
        {% endfor %}
    </div>
    
    <div style="text-align: center; margin-top: 20px; color: #FFD700;">
        <p>üéÅ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ—Ä–æ–±–∫—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–¥–∞—Ä–æ–∫! –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –Ω–µ –±–æ–ª–µ–µ 3 –∫–æ—Ä–æ–±–æ–∫.</p>
        <p>üåü –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ø–æ–¥–∞—Ä–∫–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º!</p>
    </div>
</div>

<!-- –°–Ω–µ–∂–∏–Ω–∫–∏ -->
<div class="snowflakes"></div>

<!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
<div id="message-area"></div>

<style>
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    body {
        background: linear-gradient(135deg, #1a2980, #26d0ce);
        color: white;
        font-family: 'Arial', sans-serif;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    h1 {
        text-align: center;
        color: #FFD700;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        font-size: 2.5em;
        margin-bottom: 20px;
    }
    
    .stats {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 20px;
    }
    
    .stat-item {
        text-align: center;
        background: rgba(255, 215, 0, 0.2);
        padding: 15px 25px;
        border-radius: 10px;
        min-width: 150px;
        border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .stat-value {
        font-size: 38px;
        font-weight: bold;
        color: #FFD700;
    }
    
    .controls {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .auth-controls {
        margin-bottom: 20px;
        text-align: center;
    }
    
    .user-info, .auth-links {
        display: inline-block;
        background: rgba(255, 255, 255, 0.1);
        padding: 10px 20px;
        border-radius: 25px;
        backdrop-filter: blur(10px);
    }
    
    .btn {
        background: linear-gradient(45deg, #FF416C, #FF4B2B);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1.1em;
        margin: 5px;
        transition: transform 0.3s, box-shadow 0.3s;
        text-decoration: none;
        display: inline-block;
    }

    
    #santa-btn {
        background: linear-gradient(45deg, #00b09b, #96c93d);
    }
    
    .btn-login {
        background: rgb(137, 95, 178);
    }
    
    .btn-register {
        background: rgb(103, 76, 131);
    }
    
    .btn-logout {
        background: rgb(137, 95, 178);
        margin-left: 10px;
        padding: 8px 15px;
        font-size: 0.9em;
    }
    
    #gifts-container {
        position: relative;
        width: 100%;
        height: 800px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        overflow: hidden;
        border: 2px dashed rgba(12, 102, 43, 0.965);
        margin: 20px 0;
    }
    
    /* –ö–æ—Ä–æ–±–∫–∞ —Å –ø–æ–¥–∞—Ä–∫–æ–º */
    .gift-box {
        position: absolute;
        transition: transform 0.3s, filter 0.3s;
        cursor: pointer;
        width: 120px;
        height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .gift-box-image {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }
    
    .opened-gift {
        text-align: center;
        padding: 10px;
    }
    
    .congratulation {
        font-size: 0.9em;
        margin-bottom: 10px;
        color: #FFD700;
        font-weight: bold;
    }
    
    .gift-inside {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 10px;
        border: 2px solid #FFD700;
    }
    
    /* –ò–∫–æ–Ω–∫–∞ –∑–∞–º–∫–∞ */
    .lock-icon {
        position: absolute;
        top: 5px;
        right: 5px;
        font-size: 20px;
        color: #FFD700;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞–¥–∞—é—â–∏—Ö —Å–Ω–µ–∂–∏–Ω–æ–∫ */
    @keyframes fall {
        to {
            transform: translateY(100vh) rotate(360deg);
        }
    }
    
</style>
{% endblock %}